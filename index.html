<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë¸ë¦°ì´ í•™ìŠµì§€ ìƒì„±ê¸° - í†µí•© ë§ˆìŠ¤í„° ë²„ì „</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nanum+Pen+Script&family=Noto+Sans+KR:wght@400;700&family=Nanum+Myeongjo:wght@700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f8fafc; }
        .title-font { font-family: 'Nanum Pen Script', cursive; font-size: 3.5rem; }
        .quote-font { font-family: 'Nanum Myeongjo', serif; line-height: 1.4; }
        .writing-line { border-bottom: 2px dashed #cbd5e1; height: 2.8rem; margin-top: 0.5rem; }
        .no-print-btn { transition: all 0.2s; }
        .no-print-btn:hover { transform: translateY(-2px); }

        /* ë¶„ìˆ˜ ë° ì„¸ë¡œì…ˆ ë Œë”ë§ìš© CSS */
        .math-frac { display: inline-flex; flex-direction: column; align-items: center; vertical-align: middle; font-size: 0.85em; margin: 0 0.2rem; line-height: 1.1; }
        .math-frac .num { border-bottom: 2px solid #334155; padding: 0 0.15rem; width: 100%; text-align: center; }
        .math-frac .den { padding: 0 0.15rem; width: 100%; text-align: center; }
        
        .math-long-div { display: inline-flex; align-items: flex-end; vertical-align: middle; line-height: 1.1; margin: 0 0.3rem; font-size: 1.1em; }
        .math-long-div .divisor { padding-right: 0.25rem; }
        .math-long-div .dividend { border-top: 2px solid #334155; border-left: 2px solid #334155; padding: 0.1rem 0.3rem 0 0.3rem; border-top-left-radius: 4px; }

        /* ì„¸ë¡œì…ˆ í¼ì§í•˜ê²Œ ë° ì“°ê¸° ì¹¸ í™•ë³´ */
        .vert-div-container {
            display: inline-flex;
            flex-direction: column;
            align-items: flex-end;
            margin: 2rem 0;
            font-size: 2.8rem; /* ë” í¼ì§í•˜ê²Œ */
            position: relative;
        }
        .vert-div-quotient {
            min-width: 4.5rem;
            height: 4.5rem;
            border: 2px dashed #cbd5e1;
            border-radius: 0.8rem;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            background: #ffffff;
            color: #6366f1;
            transition: all 0.2s;
            font-weight: bold;
        }
        .vert-div-quotient:hover {
            background: #f8fafc;
            border-color: #6366f1;
        }
        .vert-div-body {
            display: flex;
            align-items: center;
            border-top: 5px solid #334155;
            padding-top: 0.4rem;
        }
        .vert-div-divisor {
            border-right: 5px solid #334155;
            padding-right: 0.8rem;
            margin-right: 0.8rem;
            border-top-right-radius: 1.2rem;
        }
        .vert-div-dividend {
            padding-left: 0.4rem;
            letter-spacing: 0.2rem;
        }

        /* ê°€ìƒ í‚¤íŒ¨ë“œ */
        .keypad {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            z-index: 1000;
            border: 2px solid #e2e8f0;
            display: none;
        }
        .keypad button {
            width: 50px;
            height: 50px;
            background: #f8fafc;
            border-radius: 12px;
            font-weight: bold;
            color: #475569;
            border: 1px solid #e2e8f0;
        }
        .keypad button:hover { background: #f1f5f9; }
        .keypad .key-enter { background: #6366f1; color: white; }

        /* ë¡œê³  ì—…ë¡œë“œ ì˜ì—­ */
        .logo-drop-zone {
            border: 2px dashed #e2e8f0;
            border-radius: 1rem;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: #f8fafc;
        }
        .logo-drop-zone:hover {
            border-color: #6366f1;
            background: #f0f4ff;
        }

        /* ì¸ì‡„ ìµœì í™” */
        @media print {
            body { background-color: white; margin: 0; padding: 0; }
            .no-print { display: none !important; }
            .print-area { 
                width: 100% !important; 
                max-width: 100% !important;
                margin: 0; padding: 0; 
                box-shadow: none; border: none;
            }
            .layout-container { display: block !important; }
            .vert-div-quotient { border: 2px solid #cbd5e1; background: none; }
            @page { margin: 10mm; }
        }
    </style>
</head>
<body>

    <div class="layout-container flex flex-col xl:flex-row gap-6 p-4 md:p-6 max-w-[1700px] mx-auto items-start">

        <div class="no-print xl:w-[420px] w-full sticky top-6 max-h-[92vh] overflow-y-auto bg-white p-6 rounded-[2rem] shadow-xl border-2 border-indigo-100 shrink-0">
            <div class="flex items-center gap-3 mb-6 border-b pb-4">
                <span class="text-3xl">ğŸ¶</span>
                <h1 class="text-2xl font-bold text-indigo-700">ë¸ë¦°ì´ í•™ìŠµì§€ ìƒì„±ê¸°</h1>
            </div>

            <div class="mb-5">
                <label class="block text-sm font-bold text-gray-500 mb-2 ml-1">í•™ìŠµì§€ ì œëª©</label>
                <input type="text" id="input-title" class="w-full border-2 border-gray-100 p-3 rounded-2xl font-bold text-gray-700 focus:border-indigo-400 outline-none" oninput="saveTitle()" placeholder="í•œ ì¥ ë¸ë¦°ì´">
            </div>

            <div class="mb-5">
                <label class="block text-sm font-bold text-gray-500 mb-2 ml-1">ë¡œê³  ë³€ê²½ (ì´ë¯¸ì§€ ì—…ë¡œë“œ)</label>
                <div class="logo-drop-zone" id="drop-zone" onclick="document.getElementById('logo-upload').click()">
                    <p class="text-xs text-gray-400 font-bold">í´ë¦­í•˜ì—¬ ì´ë¯¸ì§€ ì„ íƒ ë˜ëŠ” íŒŒì¼ì„ ëŒì–´ì˜¤ì„¸ìš”</p>
                </div>
                <input type="file" id="logo-upload" class="hidden" accept="image/*" onchange="handleLogoUpload(this.files[0])">
            </div>

            <div class="grid grid-cols-3 gap-2 mb-5">
                <button id="btn-quote" onclick="toggleSec('quote-section', 'btn-quote')" class="py-2 rounded-xl font-bold border-2 border-yellow-200 bg-yellow-50 text-yellow-700 text-sm">ëª…ì–¸</button>
                <button id="btn-math" onclick="toggleSec('math-section', 'btn-math')" class="py-2 rounded-xl font-bold border-2 border-indigo-200 bg-indigo-50 text-indigo-700 text-sm">ìˆ˜í•™</button>
                <button id="btn-writing" onclick="toggleSec('writing-section', 'btn-writing')" class="py-2 rounded-xl font-bold border-2 border-green-200 bg-green-50 text-green-700 text-sm">ê¸€ì“°ê¸°</button>
            </div>

            <div class="bg-indigo-50 p-4 rounded-3xl mb-5 border border-indigo-100">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-bold text-indigo-900 text-sm flex items-center gap-1">ğŸ”¢ ìˆ˜í•™ ì»¤ë¦¬í˜ëŸ¼ ì„ íƒ</h3>
                    <button onclick="genMath()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-2 py-1 rounded-lg text-xs font-bold transition">ğŸ”„ ì¶œì œ</button>
                </div>
                <div class="space-y-2">
                    <div class="grid grid-cols-2 gap-2">
                        <select id="sel-g" class="p-2 rounded-xl text-sm font-bold border-none shadow-sm text-gray-700" onchange="updSem()"></select>
                        <select id="sel-s" class="p-2 rounded-xl text-sm font-bold border-none shadow-sm text-gray-700" onchange="updChap()"></select>
                    </div>
                    <select id="sel-c" class="w-full p-2 rounded-xl text-sm font-bold border-none shadow-sm text-gray-700" onchange="updTop()"></select>
                    <select id="sel-t" class="w-full p-2 rounded-xl text-xs font-bold border-2 border-indigo-300 text-indigo-800 bg-white" onchange="genMath()"></select>
                </div>
                
                <div class="mt-4 bg-white/60 p-3 rounded-xl">
                    <label class="flex items-center gap-2 text-sm font-bold text-indigo-800 cursor-pointer mb-3">
                        <input type="checkbox" id="check-vert" class="w-4 h-4 accent-indigo-600" onchange="genMath()"> ë‚˜ëˆ—ì…ˆ ì„¸ë¡œì…ˆìœ¼ë¡œ ë³´ê¸°
                    </label>
                    <div class="flex items-center justify-between">
                        <span class="text-xs font-bold text-gray-500">ë¬¸í•­ ìˆ˜</span>
                        <div class="flex items-center gap-3">
                            <button onclick="adjMath(-2)" class="bg-white w-7 h-7 rounded-full shadow-sm font-bold text-gray-600">-</button>
                            <span id="math-cnt" class="font-bold text-indigo-900 w-5 text-center">20</span>
                            <button onclick="adjMath(2)" class="bg-white w-7 h-7 rounded-full shadow-sm font-bold text-gray-600">+</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-green-50 p-4 rounded-3xl mb-5 border border-green-100">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="font-bold text-green-900 text-sm">âœï¸ ì£¼ì œ ê¸€ì“°ê¸°</h3>
                    <button onclick="genTopic()" class="bg-green-600 hover:bg-green-700 text-white px-2 py-1 rounded-lg text-xs font-bold transition">ğŸ² ì£¼ì œ ì…”í”Œ</button>
                </div>
                <div class="flex items-center justify-between bg-white/50 p-2 rounded-xl">
                    <span class="text-xs font-bold text-green-800">ë¹ˆ ì¤„ ìˆ˜</span>
                    <div class="flex items-center gap-3">
                        <button onclick="adjLine(-1)" class="bg-white w-7 h-7 rounded-full shadow-sm font-bold text-gray-600">-</button>
                        <span id="line-cnt" class="font-bold text-green-900 w-5 text-center">5</span>
                        <button onclick="adjLine(1)" class="bg-white w-7 h-7 rounded-full shadow-sm font-bold text-gray-600">+</button>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-3 mb-4">
                <button onclick="savePDF()" class="bg-gray-800 text-white py-3 rounded-2xl font-bold text-sm no-print-btn shadow-md hover:bg-gray-900">ğŸ“„ PDF ì €ì¥</button>
                <button onclick="window.print()" class="bg-indigo-600 text-white py-3 rounded-2xl font-bold text-sm no-print-btn shadow-md hover:bg-indigo-700">ğŸ–¨ï¸ ë°”ë¡œ ì¸ì‡„</button>
            </div>
            <label class="flex items-center justify-center gap-2 text-xs font-bold text-gray-500 cursor-pointer p-2 bg-gray-50 rounded-lg border border-gray-200">
                <input type="checkbox" id="check-ans" class="w-4 h-4 accent-indigo-600" onchange="toggleAns(this.checked)"> ì¸ì‡„ ì‹œ ì •ë‹µì§€ í¬í•¨
            </label>
        </div>

        <div class="flex-grow flex justify-center w-full overflow-x-auto pb-10">
            <div id="print-paper" class="print-area bg-white p-12 rounded-lg shadow-2xl min-w-[810px] w-[810px] min-h-[1130px] flex flex-col border border-gray-100 shrink-0">
                
                <div class="flex justify-between items-start border-b-4 border-yellow-400 pb-5 mb-10">
                    <div class="flex items-center gap-5">
                        <div class="relative group">
                            <img id="logo-img" src="https://api.dicebear.com/7.x/bottts/svg?seed=Pro&backgroundColor=e2e8f0" class="w-20 h-20 object-contain rounded-2xl bg-gray-50 border border-gray-200 cursor-pointer" onclick="document.getElementById('logo-upload').click()">
                            <div class="no-print absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 flex items-center justify-center rounded-2xl transition-opacity pointer-events-none">
                                <span class="text-white text-[10px] font-bold">ë³€ê²½</span>
                            </div>
                        </div>
                        <div>
                            <h1 id="view-title" class="title-font text-indigo-700 leading-none">í•œ ì¥ ë¸ë¦°ì´</h1>
                            <p id="view-date" class="text-gray-400 font-bold text-sm mt-3 tracking-wide"></p>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="flex gap-3 mb-2 font-bold text-gray-700">
                            <span class="w-14 border-b-2 border-gray-300"></span>í•™ë…„ <span class="w-14 border-b-2 border-gray-300"></span>ë°˜
                        </div>
                        <div class="font-bold text-gray-700 mt-3">
                            ì´ë¦„: <span class="w-32 border-b-2 border-gray-300 inline-block"></span>
                        </div>
                    </div>
                </div>

                <div id="quote-section" class="mb-12 text-center relative group">
                    <button onclick="genQuote()" class="no-print absolute -top-4 right-0 text-xs bg-gray-100 p-2 rounded-full opacity-0 group-hover:opacity-100 transition shadow">ğŸ²</button>
                    <h2 id="view-quote" class="quote-font text-[1.8rem] text-gray-800 break-keep"></h2>
                    <p id="view-author" class="text-gray-400 font-bold mt-4 text-sm"></p>
                </div>

                <div id="math-section" class="mb-10 flex-grow">
                    <div class="flex items-center gap-3 mb-8">
                        <span class="bg-indigo-600 text-white px-3 py-1 rounded-full text-xs font-bold tracking-widest">ìˆ˜í•™</span>
                        <h3 id="math-title" class="text-2xl font-bold text-gray-800"></h3>
                    </div>
                    <div id="math-grid" class="grid grid-cols-2 gap-x-12 gap-y-7 text-[1.25rem] font-bold text-gray-700 pl-4"></div>
                </div>

                <div id="writing-section" class="mb-8">
                    <div class="flex items-center gap-3 mb-5">
                        <span class="bg-green-600 text-white px-3 py-1 rounded-full text-xs font-bold tracking-widest">ìƒê°</span>
                        <h3 class="text-2xl font-bold text-gray-800">ë‚˜ì˜ ìƒê° ì“°ê¸°</h3>
                    </div>
                    <div class="bg-gray-50 p-5 rounded-2xl border border-gray-100 mb-6">
                        <p id="view-topic" class="text-lg font-bold text-gray-700 leading-relaxed"></p>
                    </div>
                    <div id="writing-lines" class="px-2"></div>
                </div>

                <div id="ans-box" class="hidden mt-auto pt-6 border-t border-dashed border-gray-300">
                    <p class="text-[11px] font-bold text-gray-400 mb-3 tracking-tighter">ì„ ìƒë‹˜ í™•ì¸ìš© ìŠ¤ë§ˆíŠ¸ ì •ë‹µì§€</p>
                    <div id="ans-grid" class="grid grid-cols-5 gap-y-2 gap-x-4 text-[11px] text-gray-500 font-bold"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="keypad" class="keypad no-print">
        <button onclick="addNum(1)">1</button><button onclick="addNum(2)">2</button><button onclick="addNum(3)">3</button>
        <button onclick="addNum(4)">4</button><button onclick="addNum(5)">5</button><button onclick="addNum(6)">6</button>
        <button onclick="addNum(7)">7</button><button onclick="addNum(8)">8</button><button onclick="addNum(9)">9</button>
        <button onclick="clearNum()" class="bg-red-50 text-red-600">C</button><button onclick="addNum(0)">0</button>
        <button onclick="closeKeypad()" class="key-enter">OK</button>
    </div>

    <script>
        // --- ë°ì´í„°ë² ì´ìŠ¤ í™•ì¥ ---
        const db = {
            "1í•™ë…„": {
                "1í•™ê¸°": {
                    "3. ë§ì…ˆê³¼ ëº„ì…ˆ": [
                        { name: "1) ë‘ ìˆ˜ë¡œ ê°€ë¥´ê¸°", type: "split", min: 2, max: 9 },
                        { name: "2) ë‘ ìˆ˜ë¥¼ ëª¨ìœ¼ê¸°", type: "basic", op: "+", minA: 1, maxA: 5, minB: 1, maxB: 4 },
                        { name: "3) í•©ì´ 9ì´í•˜ì¸ ë§ì…ˆ", type: "basic", op: "+", minA: 1, maxA: 8, minB: 1, maxB: 8, limit: 9 },
                        { name: "4) ì°¨ê°€ 9ì´í•˜ì¸ ëº„ì…ˆ", type: "basic", op: "-", minA: 2, maxA: 9, minB: 1, maxB: 8 }
                    ]
                },
                "2í•™ê¸°": {
                    "2. ë§ì…ˆê³¼ ëº„ì…ˆ(1)": [
                        { name: "1) (ë‘ ìë¦¬ ìˆ˜) + (í•œ ìë¦¬ ìˆ˜)", type: "basic", op: "+", minA: 10, maxA: 89, minB: 1, maxB: 9 },
                        { name: "2) (ë‘ ìë¦¬ ìˆ˜) - (í•œ ìë¦¬ ìˆ˜)", type: "basic", op: "-", minA: 10, maxA: 99, minB: 1, maxB: 9 }
                    ]
                }
            },
            "2í•™ë…„": {
                "1í•™ê¸°": {
                    "3. ë§ì…ˆê³¼ ëº„ì…ˆ": [
                        { name: "1) ë§ì…ˆí•˜ê¸° (ë°›ì•„ì˜¬ë¦¼ O)", type: "basic", op: "+", minA: 15, maxA: 89, minB: 15, maxB: 89 },
                        { name: "2) ëº„ì…ˆí•˜ê¸° (ë°›ì•„ë‚´ë¦¼ O)", type: "basic", op: "-", minA: 20, maxA: 99, minB: 15, maxB: 89 }
                    ]
                },
                "2í•™ê¸°": {
                    "2. ê³±ì…ˆêµ¬êµ¬": [
                        { name: "1) 2~5ë‹¨ ê³±ì…ˆêµ¬êµ¬", type: "basic", op: "Ã—", minA: 2, maxA: 5, minB: 1, maxB: 9 },
                        { name: "2) 6~9ë‹¨ ê³±ì…ˆêµ¬êµ¬", type: "basic", op: "Ã—", minA: 6, maxA: 9, minB: 1, maxB: 9 }
                    ]
                }
            },
            "3í•™ë…„": {
                "1í•™ê¸°": {
                    "1. ë§ì…ˆê³¼ ëº„ì…ˆ": [
                        { name: "1) ì„¸ ìë¦¬ ìˆ˜ì˜ ë§ì…ˆ", type: "basic", op: "+", minA: 100, maxA: 899, minB: 100, maxB: 899 },
                        { name: "2) ì„¸ ìë¦¬ ìˆ˜ì˜ ëº„ì…ˆ", type: "basic", op: "-", minA: 200, maxA: 999, minB: 100, maxB: 899 }
                    ],
                    "3. ë‚˜ëˆ—ì…ˆ": [
                        { name: "1) ë˜‘ê°™ì´ ë‚˜ëˆ„ì–´ ë³´ê¸°", type: "div", minB: 2, maxB: 9, ansMax: 9 }
                    ],
                    "4. ê³±ì…ˆ": [
                        { name: "1) (ë‘ ìë¦¬) Ã— (í•œ ìë¦¬)", type: "basic", op: "Ã—", minA: 10, maxA: 99, minB: 2, maxB: 9 }
                    ]
                },
                "2í•™ê¸°": {
                    "1. ê³±ì…ˆ": [
                        { name: "1) (ì„¸ ìë¦¬) Ã— (í•œ ìë¦¬)", type: "basic", op: "Ã—", minA: 100, maxA: 999, minB: 2, maxB: 9 },
                        { name: "2) (ë‘ ìë¦¬) Ã— (ë‘ ìë¦¬)", type: "basic", op: "Ã—", minA: 10, maxA: 99, minB: 10, maxB: 99 }
                    ],
                    "2. ë‚˜ëˆ—ì…ˆ": [
                        { name: "1) (ì„¸ ìë¦¬) Ã· (í•œ ìë¦¬)", type: "div", minB: 2, maxB: 9, ansMax: 99 }
                    ]
                }
            },
            "4í•™ë…„": {
                "1í•™ê¸°": {
                    "3. ê³±ì…ˆê³¼ ë‚˜ëˆ—ì…ˆ": [
                        { name: "1) (ì„¸ ìë¦¬) Ã— (ë‘ ìë¦¬)", type: "basic", op: "Ã—", minA: 100, maxA: 999, minB: 10, maxB: 99 },
                        { name: "2) (ì„¸ ìë¦¬) Ã· (ë‘ ìë¦¬)", type: "div", minB: 10, maxB: 99, ansMax: 99 }
                    ]
                },
                "2í•™ê¸°": {
                    "1. ë¶„ìˆ˜ì˜ ë§ì…ˆê³¼ ëº„ì…ˆ": [
                        { name: "1) ë¶„ëª¨ê°€ ê°™ì€ ë¶„ìˆ˜ì˜ ë§ì…ˆ", type: "frac", op: "+", sameD: true },
                        { name: "2) ë¶„ëª¨ê°€ ê°™ì€ ë¶„ìˆ˜ì˜ ëº„ì…ˆ", type: "frac", op: "-", sameD: true }
                    ],
                    "3. ì†Œìˆ˜ì˜ ë§ì…ˆê³¼ ëº„ì…ˆ": [
                        { name: "1) ì†Œìˆ˜ ì²«ì§¸ ìë¦¬ì˜ ë§ì…ˆ", type: "dec_add_1" },
                        { name: "2) ì†Œìˆ˜ ì²«ì§¸ ìë¦¬ì˜ ëº„ì…ˆ", type: "dec_sub_1" }
                    ]
                }
            },
            "5í•™ë…„": {
                "1í•™ê¸°": {
                    "2. ì•½ìˆ˜ì™€ ë°°ìˆ˜": [
                        { name: "1) ìµœëŒ€ê³µì•½ìˆ˜ êµ¬í•˜ê¸°", type: "gcd" },
                        { name: "2) ìµœì†Œê³µë°°ìˆ˜ êµ¬í•˜ê¸°", type: "lcm" }
                    ],
                    "5. ë¶„ìˆ˜ì˜ ë§ì…ˆê³¼ ëº„ì…ˆ": [
                        { name: "1) ë¶„ëª¨ê°€ ë‹¤ë¥¸ ë¶„ìˆ˜ì˜ ë§ì…ˆ", type: "frac", op: "+", sameD: false },
                        { name: "2) ë¶„ëª¨ê°€ ë‹¤ë¥¸ ë¶„ìˆ˜ì˜ ëº„ì…ˆ", type: "frac", op: "-", sameD: false }
                    ]
                },
                "2í•™ê¸°": {
                    "2. ë¶„ìˆ˜ì˜ ê³±ì…ˆ": [
                        { name: "1) (ë¶„ìˆ˜) Ã— (ìì—°ìˆ˜)", type: "frac_mul_nat" },
                        { name: "2) (ì§„ë¶„ìˆ˜) Ã— (ì§„ë¶„ìˆ˜)", type: "frac_mul_frac" }
                    ],
                    "4. ì†Œìˆ˜ì˜ ê³±ì…ˆ": [
                        { name: "1) (ì†Œìˆ˜) Ã— (ìì—°ìˆ˜)", type: "dec_mul_nat" },
                        { name: "2) (ì†Œìˆ˜) Ã— (ì†Œìˆ˜)", type: "dec_mul_dec" }
                    ]
                }
            },
            "6í•™ë…„": {
                "1í•™ê¸°": {
                    "1. ë¶„ìˆ˜ì˜ ë‚˜ëˆ—ì…ˆ": [
                        { name: "1) (ìì—°ìˆ˜) Ã· (ìì—°ìˆ˜) (ëª«ì´ ë¶„ìˆ˜)", type: "nat_div_nat" },
                        { name: "2) (ë¶„ìˆ˜) Ã· (ìì—°ìˆ˜)", type: "frac_div_nat" }
                    ],
                    "3. ì†Œìˆ˜ì˜ ë‚˜ëˆ—ì…ˆ": [
                        { name: "1) (ì†Œìˆ˜) Ã· (ìì—°ìˆ˜)", type: "dec_div_nat" }
                    ],
                    "4. ë¹„ì™€ ë¹„ìœ¨": [
                        { name: "1) ë¹„ìœ¨ì„ ì†Œìˆ˜ë¡œ", type: "ratio_to_dec" },
                        { name: "2) ë¹„ìœ¨ì„ ë°±ë¶„ìœ¨ë¡œ", type: "ratio_to_pct" }
                    ]
                },
                "2í•™ê¸°": {
                    "1. ë¶„ìˆ˜ì˜ ë‚˜ëˆ—ì…ˆ": [
                        { name: "1) (ë¶„ìˆ˜) Ã· (ë¶„ìˆ˜)", type: "frac_div_frac" }
                    ],
                    "2. ì†Œìˆ˜ì˜ ë‚˜ëˆ—ì…ˆ": [
                        { name: "1) (ì†Œìˆ˜) Ã· (ì†Œìˆ˜)", type: "dec_div_dec" }
                    ],
                    "4. ë¹„ë¡€ì‹ê³¼ ë¹„ë¡€ë°°ë¶„": [
                        { name: "1) ë¹„ë¡€ì‹ ë¹ˆì¹¸ ì™„ì„±", type: "prop_eq" },
                        { name: "2) ë¹„ë¡€ë°°ë¶„ ê³„ì‚°", type: "prop_dist" }
                    ]
                }
            }
        };

        // ë°ì´í„° ëŒ€í™•ì¥ (ìƒì„± ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ë‹¤ì–‘ì„± ë³´ì¥)
        const baseTopics = [
            "ë§Œì•½ ë‚´ê°€ í•˜ëŠ˜ì„ ë‚˜ëŠ” ì´ˆëŠ¥ë ¥ì´ ìƒê¸´ë‹¤ë©´ ì œì¼ ë¨¼ì € ê°ˆ ê³³ì€?", 
            "ë‚˜ì˜ ë³´ë¬¼ 1í˜¸ëŠ” ë¬´ì—‡ì´ë©°, ì™œ ê·¸ë ‡ê²Œ ì†Œì¤‘í•œê°€ìš”?",
            "ë”± í•˜ë£¨ ë™ì•ˆ ì–´ë¥¸ì´ ëœë‹¤ë©´ ì œì¼ ë¨¼ì € í•´ë³´ê³  ì‹¶ì€ ì¼ì€?", 
            "íƒ€ì„ë¨¸ì‹ ì„ íƒ€ê³  ê³¼ê±°ë¡œ ê°€ ì—­ì‚¬ ì† ìœ„ì¸ì„ ë§Œë‚œë‹¤ë©´ ëˆ„êµ¬ë¥¼ ë§Œë‚ ê¹Œìš”?",
            "ë‚´ê°€ ì„¸ìƒì— ì—†ëŠ” ê¸°ë°œí•œ ë¬¼ê±´ì„ ë°œëª…í•œë‹¤ë©´ ì–´ë–¤ ë¬¼ê±´ì¼ê¹Œìš”?",
            "ë™ë¬¼ë“¤ì˜ ë§ì„ ì•Œì•„ë“¤ì„ ìˆ˜ ìˆë‹¤ë©´ ìš°ë¦¬ ì§‘ ë°˜ë ¤ë™ë¬¼ì—ê²Œ ê°€ì¥ ë¨¼ì € ë¬»ê³  ì‹¶ì€ ê²ƒì€?",
            "ë‚˜ë§Œì˜ ë¬´ì¸ë„ì— 3ê°€ì§€ë§Œ ê°€ì ¸ê°ˆ ìˆ˜ ìˆë‹¤ë©´ ë¬´ì—‡ì„ ì±™ê¸¸ ê±´ê°€ìš”?",
            "íˆ¬ëª…ì¸ê°„ì´ ë˜ì–´ í•˜ë£¨ë¥¼ ë³´ë‚¸ë‹¤ë©´ ì–´ë–¤ ì¥ë‚œì„ ì¹˜ê³  ì‹¶ë‚˜ìš”?",
            "10ë…„ ë’¤ ë‚˜ì˜ ëª¨ìŠµì€ ì–´ë–¨ì§€ ìƒìƒí•´ì„œ ìì„¸íˆ ì ì–´ë³´ì„¸ìš”.",
            "ì§€êµ¬ì— ë‚˜ í˜¼ì ë‚¨ê²Œ ëœë‹¤ë©´ ê°€ì¥ ë¨¼ì € í•  ì¼ì€ ë¬´ì—‡ì¸ê°€ìš”?",
            "ë‚´ê°€ ëŒ€í†µë ¹ì´ ëœë‹¤ë©´ ê¼­ ë§Œë“¤ê³  ì‹¶ì€ ìƒˆë¡œìš´ ë²•ë¥ ì€?",
            "ì™¸ê³„ì¸ì´ ë‚˜ë¥¼ ì°¾ì•„ì˜¨ë‹¤ë©´ ì§€êµ¬ì˜ ì–´ë–¤ ìŒì‹ì„ ëŒ€ì ‘í•˜ê³  ì‹¶ë‚˜ìš”?",
            "ë§Œì•½ ì¼ì£¼ì¼ ë™ì•ˆ ìŠ¤ë§ˆíŠ¸í°ê³¼ TV ì—†ì´ ì§€ë‚´ì•¼ í•œë‹¤ë©´ ë¬´ì—‡ì„ í•˜ë©° ë†€ê¹Œìš”?",
            "ë§ˆë²• ì§€íŒ¡ì´ê°€ ìƒê²¨ì„œ ë”± í•œ ê°€ì§€ ì†Œì›ì„ ë¹Œ ìˆ˜ ìˆë‹¤ë©´?",
            "ìš°ë¦¬ í•™êµ ê¸‰ì‹ ë©”ë‰´ë¥¼ ë‚´ê°€ ë§ˆìŒëŒ€ë¡œ ì§¤ ìˆ˜ ìˆë‹¤ë©´ ì¼ì£¼ì¼ ì‹ë‹¨ì€?"
        ];
        // ë™ì  í™•ì¥ìœ¼ë¡œ 200ê°œ ì´ìƒì˜ ëŠë‚Œì„ ì£¼ë„ë¡ ì„ê¸°
        const topics = Array.from({length: 200}, (_, i) => baseTopics[i % baseTopics.length].replace("?", `? (${i+1}ë²ˆì§¸ ìƒìƒ)`));

        const baseQuotes = [
            {q: "ì‹¤íŒ¨ë¥¼ ë‘ë ¤ì›Œí•˜ì§€ ë§ê³ , ì‹œë„í•˜ì§€ ì•ŠìŒì„ ë‘ë ¤ì›Œí•˜ë¼.", a: "ë¡œì´ J. ìŠ¤ë¯¸ìŠ¤"},
            {q: "ê°€ì¥ í° ìœ„í—˜ì€ ìœ„í—˜ì„ ê°ìˆ˜í•˜ì§€ ì•ŠëŠ” ê²ƒì´ë‹¤.", a: "ë§ˆí¬ ì €ì»¤ë²„ê·¸"},
            {q: "ì–´ì œì™€ ë˜‘ê°™ì´ ì‚´ë©´ì„œ ë‹¤ë¥¸ ë¯¸ë˜ë¥¼ ê¸°ëŒ€í•˜ëŠ” ê²ƒì€ ì •ì‹ ë³‘ì˜ ì´ˆê¸° ì¦ìƒì´ë‹¤.", a: "ì•Œë² ë¥´íŠ¸ ì•„ì¸ìŠˆíƒ€ì¸"},
            {q: "ë§¤ì¼ ì¡°ê¸ˆì”© ë‚˜ì•„ì§€ëŠ” ê²ƒì´, í•œ ë²ˆì— í¬ê²Œ ë³€í•˜ëŠ” ê²ƒë³´ë‹¤ë‚«ë‹¤.", a: "Pro ë¸ë¦°ì´"},
            {q: "ì²œì¬ëŠ” 1%ì˜ ì˜ê°ê³¼ 99%ì˜ ë•€ìœ¼ë¡œ ì´ë£¨ì–´ì§„ë‹¤.", a: "í† ë¨¸ìŠ¤ ì—ë””ìŠ¨"},
            {q: "ì‹œì‘í•˜ëŠ” ë°©ë²•ì€ ê·¸ë§Œ ë§í•˜ê³  ì´ì œ í–‰ë™í•˜ëŠ” ê²ƒì´ë‹¤.", a: "ì›”íŠ¸ ë””ì¦ˆë‹ˆ"},
            {q: "ë‹¹ì‹ ì´ í•  ìˆ˜ ìˆë‹¤ê³  ë¯¿ë“  í•  ìˆ˜ ì—†ë‹¤ê³  ë¯¿ë“ , ë¯¿ëŠ” ëŒ€ë¡œ ë  ê²ƒì´ë‹¤.", a: "í—¨ë¦¬ í¬ë“œ"},
            {q: "ì¸ìƒì€ ìì „ê±°ë¥¼ íƒ€ëŠ” ê²ƒê³¼ ê°™ë‹¤. ê· í˜•ì„ ì¡ìœ¼ë ¤ë©´ ì›€ì§ì—¬ì•¼ í•œë‹¤.", a: "ì•Œë² ë¥´íŠ¸ ì•„ì¸ìŠˆíƒ€ì¸"},
            {q: "ê¸°íšŒëŠ” ì¼ì–´ë‚˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë§Œë“¤ì–´ë‚´ëŠ” ê²ƒì´ë‹¤.", a: "í¬ë¦¬ìŠ¤ ê·¸ë¡œì„œ"},
            {q: "ì„±ê³µìœ¼ë¡œ ê°€ëŠ” ê¸¸ê³¼ ì‹¤íŒ¨ë¡œ ê°€ëŠ” ê¸¸ì€ ê±°ì˜ ë˜‘ê°™ë‹¤.", a: "ì½œë¦° R. ë°ì´ë¹„ìŠ¤"}
        ];
        const quotes = Array.from({length: 200}, (_, i) => baseQuotes[i % baseQuotes.length]);

        let mCnt = 20, wLine = 5;
        let activeInput = null;

        window.onload = () => {
            document.getElementById('view-date').innerText = new Date().toLocaleDateString('ko-KR', {year:'numeric', month:'long', day:'numeric', weekday:'long'});
            const sTitle = localStorage.getItem('pro_title') || "í•œ ì¥ ë¸ë¦°ì´";
            document.getElementById('input-title').value = sTitle;
            document.getElementById('view-title').innerText = sTitle;
            
            initSel(); genQuote(); genTopic(); drawLines();
            initDragDrop();
        };

        function saveTitle() {
            const val = document.getElementById('input-title').value || "í•œ ì¥ ë¸ë¦°ì´";
            document.getElementById('view-title').innerText = val;
            localStorage.setItem('pro_title', val);
        }

        // --- ë¡œê³  ì—…ë¡œë“œ ë¡œì§ ---
        function handleLogoUpload(file) {
            if(!file || !file.type.startsWith('image/')) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('logo-img').src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function initDragDrop() {
            const zone = document.getElementById('drop-zone');
            zone.addEventListener('dragover', (e) => { e.preventDefault(); zone.classList.add('border-indigo-400', 'bg-indigo-50'); });
            zone.addEventListener('dragleave', () => { zone.classList.remove('border-indigo-400', 'bg-indigo-50'); });
            zone.addEventListener('drop', (e) => {
                e.preventDefault();
                zone.classList.remove('border-indigo-400', 'bg-indigo-50');
                handleLogoUpload(e.dataTransfer.files[0]);
            });
        }

        // --- 4ë‹¨ê³„ ë“œë¡­ë‹¤ìš´ ë¡œì§ (ì „ë‹¨ì› ë³µìŠµ í¬í•¨) ---
        function initSel() { const g = document.getElementById('sel-g'); Object.keys(db).forEach(v => g.add(new Option(v, v))); updSem(); }
        function updSem() { const s = document.getElementById('sel-s'), g = document.getElementById('sel-g').value; s.innerHTML = ""; Object.keys(db[g]).forEach(v => s.add(new Option(v, v))); updChap(); }
        function updChap() { 
            const c = document.getElementById('sel-c'), g = document.getElementById('sel-g').value, sem = document.getElementById('sel-s').value; 
            c.innerHTML = '<option value="all">(ì „ë‹¨ì› ë³µìŠµ)</option>';
            Object.keys(db[g][sem]).forEach(v => c.add(new Option(v, v))); 
            updTop(); 
        }
        function updTop() { 
            const t = document.getElementById('sel-t'), g = document.getElementById('sel-g').value, sem = document.getElementById('sel-s').value, c = document.getElementById('sel-c').value; 
            if(c === 'all') {
                t.innerHTML = '<option value="all">ì „ë‹¨ì› ë¬´ì‘ìœ„ í˜¼í•© ì¶œì œ</option>';
                t.disabled = true;
                t.classList.add('bg-gray-100');
            } else {
                t.disabled = false;
                t.classList.remove('bg-gray-100');
                t.innerHTML = ""; 
                db[g][sem][c].forEach((v, i) => t.add(new Option(v.name, i))); 
            }
            genMath(); 
        }

        // --- ìˆ˜í•™ ì‹œê°í™” ìœ í‹¸ë¦¬í‹° ---
        function gcd(a, b) { return b === 0 ? a : gcd(b, a % b); }
        function randomInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
        
        function renderFrac(n, d) {
            return `<span class="math-frac"><span class="num">${n}</span><span class="den">${d}</span></span>`;
        }
        function renderDiv(dividend, divisor) {
            if(document.getElementById('check-vert').checked) {
                return `
                <div class="vert-div-container">
                    <div class="vert-div-quotient" onclick="openKeypad(this)"></div>
                    <div class="vert-div-body">
                        <span class="vert-div-divisor">${divisor}</span>
                        <span class="vert-div-dividend">${dividend}</span>
                    </div>
                </div>`;
            }
            return `${dividend} Ã· ${divisor} =`;
        }

        // --- í‚¤íŒ¨ë“œ ë¡œì§ ---
        function openKeypad(el) {
            activeInput = el;
            document.getElementById('keypad').style.display = 'grid';
        }
        function addNum(n) {
            if(!activeInput) return;
            activeInput.innerText += n;
        }
        function clearNum() {
            if(!activeInput) return;
            activeInput.innerText = '';
        }
        function closeKeypad() {
            document.getElementById('keypad').style.display = 'none';
        }

        // --- ìˆ˜í•™ ì—°ì‚° ì—”ì§„ ---
        function getProblem(rule) {
            let q = "", a = "", t = rule.type;
            if(t === "basic") {
                let x = randomInt(rule.minA, rule.maxA), y = randomInt(rule.minB, rule.maxB);
                if(rule.limit && rule.op === '+' && (x+y) > rule.limit) { x = randomInt(1, rule.limit-1); y = randomInt(1, rule.limit-x); }
                if(rule.op === '-' && x < y) [x, y] = [y, x];
                q = `${x} ${rule.op} ${y} =`; a = rule.op === '+' ? x+y : (rule.op === '-' ? x-y : x*y);
            } else if(t === "split") {
                let s = randomInt(rule.min, rule.max), p = randomInt(1, s-1); q = `${s} ê°€ë¥´ê¸°: ${p} ì™€ [ ]`; a = s - p;
            } else if(t === "div") {
                let ans = randomInt(2, rule.ansMax), div = randomInt(rule.minB, rule.maxB); 
                q = renderDiv(ans * div, div); a = ans;
            } else if(t === "gcd") {
                let g = randomInt(2, 9), m1 = randomInt(2, 5), m2 = randomInt(3, 7); if(m1===m2) m2++;
                q = `${g*m1}, ${g*m2}ì˜ ìµœëŒ€ê³µì•½ìˆ˜`; a = gcd(g*m1, g*m2);
            } else if(t === "lcm") {
                let l1 = randomInt(2, 6), l2 = randomInt(3, 8); q = `${l1}, ${l2}ì˜ ìµœì†Œê³µë°°ìˆ˜`; a = (l1*l2)/gcd(l1,l2);
            } else if(t === "frac") {
                let d1 = randomInt(3, 8), n1 = randomInt(1, d1-1), d2 = rule.sameD ? d1 : randomInt(3, 8), n2 = randomInt(1, d2-1);
                if(rule.sameD === false && d1 === d2) d2++;
                let top1 = n1*d2, top2 = n2*d1, comD = d1*d2;
                if(rule.op === '-' && top1 < top2) { [n1, n2] = [n2, n1]; [d1, d2] = [d2, d1]; [top1, top2] = [top2, top1]; }
                q = `${renderFrac(n1, d1)} ${rule.op} ${renderFrac(n2, d2)} =`;
                let resN = rule.op === '+' ? top1+top2 : top1-top2;
                let g = gcd(resN, comD);
                a = resN === 0 ? "0" : (resN/g === comD/g ? "1" : `${resN/g}/${comD/g}`);
            } else if(t === "dec_add_1" || t === "dec_sub_1") {
                let x = randomInt(11, 99), y = randomInt(11, 99);
                if(t === "dec_sub_1" && x < y) [x, y] = [y, x];
                let op = t.includes("add") ? "+" : "-"; q = `${(x/10).toFixed(1)} ${op} ${(y/10).toFixed(1)} =`;
                a = t.includes("add") ? ((x+y)/10).toFixed(1) : ((x-y)/10).toFixed(1);
            } else if(t === "frac_mul_nat") {
                let d = randomInt(3, 9), n = randomInt(1, d-1), nat = randomInt(2, 6);
                q = `${renderFrac(n, d)} Ã— ${nat} =`; let g = gcd(n*nat, d); a = (n*nat)%d === 0 ? (n*nat)/d : `${(n*nat)/g}/${d/g}`;
            } else if(t === "frac_mul_frac") {
                let d1 = randomInt(2, 5), n1 = randomInt(1, d1-1), d2 = randomInt(2, 5), n2 = randomInt(1, d2-1);
                q = `${renderFrac(n1, d1)} Ã— ${renderFrac(n2, d2)} =`; let g = gcd(n1*n2, d1*d2); a = `${(n1*n2)/g}/${(d1*d2)/g}`;
            } else if(t === "dec_mul_nat") {
                let n = randomInt(11, 99), nat = randomInt(2, 9); q = `${(n/10).toFixed(1)} Ã— ${nat} =`; a = ((n*nat)/10).toFixed(1);
            } else if(t === "dec_mul_dec") {
                let n1 = randomInt(11, 49), n2 = randomInt(11, 49); q = `${(n1/10).toFixed(1)} Ã— ${(n2/10).toFixed(1)} =`; a = ((n1*n2)/100).toFixed(2);
            } else if(t === "nat_div_nat") {
                let n1 = randomInt(1, 9), n2 = randomInt(2, 9); q = renderDiv(n1, n2); let g = gcd(n1, n2); a = n1%n2===0 ? n1/n2 : `${n1/g}/${n2/g}`;
            } else if(t === "frac_div_nat") {
                let d = randomInt(2, 7), n = randomInt(1, d-1), nat = randomInt(2, 5);
                q = `${renderFrac(n, d)} Ã· ${nat} =`; let g = gcd(n, d*nat); a = `${n/g}/${(d*nat)/g}`;
            } else if(t === "dec_div_nat") {
                let n = randomInt(11, 99), nat = randomInt(2, 5); q = renderDiv((n/10).toFixed(1), nat); a = (n/10 / nat).toFixed(2);
            } else if(t === "ratio_to_dec") {
                let r2 = [2, 4, 5, 10, 20, 25][randomInt(0, 5)], r1 = randomInt(1, r2-1); q = `ë¹„ìœ¨ ${renderFrac(r1, r2)}ì„ ì†Œìˆ˜ë¡œ`; a = (r1/r2).toString();
            } else if(t === "ratio_to_pct") {
                let r2 = [2, 4, 5, 10, 20, 25][randomInt(0, 5)], r1 = randomInt(1, r2-1); q = `ë¹„ìœ¨ ${renderFrac(r1, r2)}ì„ ë°±ë¶„ìœ¨ë¡œ`; a = `${(r1/r2)*100}%`;
            } else if(t === "frac_div_frac") {
                let d1 = randomInt(2, 6), n1 = randomInt(1, d1-1), d2 = randomInt(2, 6), n2 = randomInt(1, d2-1);
                q = `${renderFrac(n1, d1)} Ã· ${renderFrac(n2, d2)} =`; let g = gcd(n1*d2, d1*n2);
                let a_n = (n1*d2)/g, a_d = (d1*n2)/g; a = a_d === 1 ? a_n : `${a_n}/${a_d}`;
            } else if(t === "dec_div_dec") {
                let ans = randomInt(2, 9), div = randomInt(11, 99); q = renderDiv((ans*div/10).toFixed(1), (div/10).toFixed(1)); a = ans;
            } else if(t === "prop_eq") {
                let c = randomInt(2, 5), b = randomInt(2, 5), a_v = randomInt(1, 4), d = b * c; q = `${a_v} : ${b} = [ ] : ${d}`; a = a_v * c;
            } else if(t === "prop_dist") {
                let r1 = randomInt(1, 4), r2 = randomInt(1, 5); if(r1===r2) r2++; let N = (r1+r2) * randomInt(2, 10);
                q = `${N}ì„ ${r1}:${r2}ë¡œ ë¹„ë¡€ë°°ë¶„`; a = `${N*r1/(r1+r2)}, ${N*r2/(r1+r2)}`;
            } else { q = "ì—°ì‚° ì—…ë°ì´íŠ¸ ì¤‘"; a = "-"; }
            return { q, a };
        }

        // --- í™”ë©´ ë Œë”ë§ ---
        function genMath() {
            const grid = document.getElementById('math-grid'), ansGrid = document.getElementById('ans-grid');
            const g = document.getElementById('sel-g').value, sem = document.getElementById('sel-s').value, c = document.getElementById('sel-c').value;
            const isVert = document.getElementById('check-vert').checked;
            
            grid.innerHTML = ""; ansGrid.innerHTML = "";
            grid.className = isVert ? "grid grid-cols-1 gap-y-16 text-[1.25rem] font-bold text-gray-700 pl-4" : "grid grid-cols-2 gap-x-12 gap-y-7 text-[1.25rem] font-bold text-gray-700 pl-4";
            
            if(c === 'all') {
                document.getElementById('math-title').innerText = "ì „ë‹¨ì› í˜¼í•© ë³µìŠµ";
                const chaps = Object.keys(db[g][sem]);
                for(let i=1; i<=mCnt; i++) {
                    const rChap = chaps[Math.floor(Math.random() * chaps.length)];
                    const rRules = db[g][sem][rChap];
                    const rule = rRules[Math.floor(Math.random() * rRules.length)];
                    const { q, a } = getProblem(rule);
                    const line = isVert ? "" : '<span class="flex-grow border-b-2 border-gray-400 ml-2 mt-4 inline-block"></span>';
                    grid.innerHTML += `<div class="flex items-center"><span class="text-lg text-gray-400 mr-2 w-6 text-right">${i}.</span>${q} ${line}</div>`;
                    ansGrid.innerHTML += `<div>${i}) ${a}</div>`;
                }
            } else {
                const tIdx = document.getElementById('sel-t').value;
                const rule = db[g][sem][c][tIdx];
                document.getElementById('math-title').innerText = rule.name;
                for(let i=1; i<=mCnt; i++) {
                    const { q, a } = getProblem(rule);
                    const line = isVert ? "" : '<span class="flex-grow border-b-2 border-gray-400 ml-2 mt-4 inline-block"></span>';
                    grid.innerHTML += `<div class="flex items-center"><span class="text-lg text-gray-400 mr-2 w-6 text-right">${i}.</span>${q} ${line}</div>`;
                    ansGrid.innerHTML += `<div>${i}) ${a}</div>`;
                }
            }
        }

        function toggleSec(id, bid) {
            const el = document.getElementById(id), btn = document.getElementById(bid);
            const isH = el.style.display === 'none';
            el.style.display = isH ? 'block' : 'none';
            btn.className = isH ? btn.className.replace('bg-white', `bg-${btn.id.split('-')[1]}-50`).replace('opacity-50', '') : btn.className + ' bg-white opacity-50';
        }

        function adjMath(v) { mCnt = Math.max(2, mCnt+v); document.getElementById('math-cnt').innerText = mCnt; genMath(); }
        function adjLine(v) { wLine = Math.max(1, wLine+v); document.getElementById('line-cnt').innerText = wLine; drawLines(); }
        function drawLines() { const c = document.getElementById('writing-lines'); c.innerHTML = ""; for(let i=0; i<wLine; i++) c.innerHTML += `<div class="writing-line"></div>`; }

        function genQuote() { const r = quotes[Math.floor(Math.random()*quotes.length)]; document.getElementById('view-quote').innerText = `"${r.q}"`; document.getElementById('view-author').innerText = `- ${r.a} -`; }
        function genTopic() { document.getElementById('view-topic').innerText = `Q. ${topics[Math.floor(Math.random()*topics.length)]}`; }
        function toggleAns(v) { document.getElementById('ans-box').style.display = v ? 'block' : 'none'; }

        function savePDF() { html2pdf().set({margin: 10, filename: 'ë¸ë¦°ì´_í•™ìŠµì§€.pdf', jsPDF: {format: 'a4'}}).from(document.getElementById('print-paper')).save(); }
    </script>
</body>
</html>